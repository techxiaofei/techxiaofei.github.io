<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>手游服务器开发技术详解 - Leftpocket的个人博客</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="码农在新加坡" /><meta name="description" content="回顾我的码农生涯，在做互联网电商后端开发之前做过大概6年的游戏后端开发，想总结一下手游后端开发技术的方方面面。 之前从事游戏服务器开发期间参与" /><meta name="keywords" content="游戏开发" />


<meta name="baidu-site-verification" content="code-swx03nFBNS" />
<meta name="google-site-verification" content="sGfWBA2Wby1_gxJO3xmOtvpAOU2cCyhwXuU-2m4u75Y" />



<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8922621224955535"
     crossorigin="anonymous"></script>


<meta name="generator" content="Hugo 0.89.4 with theme even" />


<link rel="canonical" href="https://left-pocket.github.io/post/backend/game_development/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="手游服务器开发技术详解" />
<meta property="og:description" content="回顾我的码农生涯，在做互联网电商后端开发之前做过大概6年的游戏后端开发，想总结一下手游后端开发技术的方方面面。 之前从事游戏服务器开发期间参与" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://left-pocket.github.io/post/backend/game_development/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-21T14:00:51+08:00" />
<meta property="article:modified_time" content="2021-11-21T14:00:51+08:00" />

<meta itemprop="name" content="手游服务器开发技术详解">
<meta itemprop="description" content="回顾我的码农生涯，在做互联网电商后端开发之前做过大概6年的游戏后端开发，想总结一下手游后端开发技术的方方面面。 之前从事游戏服务器开发期间参与"><meta itemprop="datePublished" content="2021-11-21T14:00:51+08:00" />
<meta itemprop="dateModified" content="2021-11-21T14:00:51+08:00" />
<meta itemprop="wordCount" content="2710">
<meta itemprop="keywords" content="后端开发," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="手游服务器开发技术详解"/>
<meta name="twitter:description" content="回顾我的码农生涯，在做互联网电商后端开发之前做过大概6年的游戏后端开发，想总结一下手游后端开发技术的方方面面。 之前从事游戏服务器开发期间参与"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Leftpocket的个人博客</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Leftpocket的个人博客</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">手游服务器开发技术详解</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-11-21 </span>
        <div class="post-category">
            <a href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"> 后端开发 </a>
            </div>
          <span class="more-meta"> 约 2710 字 </span>
          <span class="more-meta"> 预计阅读 6 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一聊聊服务器开发有哪些东西要考虑">一.聊聊服务器开发有哪些东西要考虑</a>
      <ul>
        <li><a href="#1开发语言的选择">1.开发语言的选择</a></li>
        <li><a href="#2数据库">2.数据库</a></li>
        <li><a href="#3服务端架构">3.服务端架构</a></li>
        <li><a href="#4协议">4.协议</a></li>
        <li><a href="#5存盘">5.存盘</a></li>
      </ul>
    </li>
    <li><a href="#二开发一个游戏服务器需要掌握的开源技术">二.开发一个游戏服务器需要掌握的开源技术</a>
      <ul>
        <li><a href="#网络库">网络库</a></li>
        <li><a href="#协议解析">协议解析</a></li>
        <li><a href="#缓存">缓存</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>回顾我的码农生涯，在做互联网电商后端开发之前做过大概6年的游戏后端开发，想总结一下手游后端开发技术的方方面面。</p>
<p>之前从事游戏服务器开发期间参与了不少项目，学到了很多游戏服务器开发技术，参与过几个不同架构的服务器开发，就此聊聊游戏服务器开发需要的技术，给刚进入游戏后端开发的同学一些指导。</p>
<p>这边文章我先说一下我理解的互联网和游戏后端开发的主要区别，然后着重讲一下游戏服务器开发需要的技术栈。</p>
<p>如果你想自己写一个服务器开发框架，那么希望这篇文章对你有一定的帮助。</p>
<p>如果你想了解游戏后端开发和互联网后端开发的区别是什么，欢迎看这篇文章：</p>
<p><strong>游戏服务器和普通服务器的区别：</strong><a href="https://mp.weixin.qq.com/s?__biz=MzkwNzMwNzI1Ng==&amp;mid=2247483747&amp;idx=2&amp;sn=aa393244378465842c3fc84a0c3c639d&amp;chksm=c0da70f4f7adf9e248b07b630a989f433db71b2036b26111259921b5f189eca38a5bde113fcc&amp;token=1076447661&amp;lang=zh_CN#rd">wx公众号：游戏服务器和普通服务器的区别</a></p>
<h1 id="一聊聊服务器开发有哪些东西要考虑">一.聊聊服务器开发有哪些东西要考虑</h1>
<h2 id="1开发语言的选择">1.开发语言的选择</h2>
<p>工欲善其事,必先利其器，选择一门适合的开发语法对后期开发有着事半功倍的作用。</p>
<p>业界主要的是c/c++ + Python/lua模式做游戏服务器。c/c++做网络通讯数据传输，python/lua做业务逻辑。这样既保持了网络传输的效率(c++)，又提升开发效率(Python/lua)，同时也支持热更新。</p>
<p>当然，也有其他服务器开发语言，erlang(没用过，页游公司用的多),c#(大棒子国喜欢用，神奇的民族),Java(第一次听说时我惊呆了),node.js(少量游戏用的,还有一个node.js写的引擎叫pemolo),php(做http协议通讯的游戏时php+mysql也不失为一种好选择),&hellip;</p>
<p>看过两个游戏服务器引擎</p>
<p>1.firefly(9秒社团开发的一款python游戏服务器框架) <a href="https://github.com/9miao/Firefly">https://github.com/9miao/Firefly</a></p>
<p>2.kbengine(作者说他按bigworld的架构来设计的,c++ + python的) <a href="https://github.com/kbengine/kbengine">https://github.com/kbengine/kbengine</a></p>
<h2 id="2数据库">2.数据库</h2>
<p>现在比较流行的两种数据库，关系型数据库mysql和非关系型数据库mongodb。这是我用的最多的两个数据库。也有直接用Redis做数据储存的，当然一般是用来做缓存多一点。</p>
<h2 id="3服务端架构">3.服务端架构</h2>
<p>讲一下我用过的其中一种架构模型，也是公司按着bigworld架构设计的：</p>
<ol>
<li>
<p><strong>GateServer</strong>: 首先要有一个GateServer(网关)服务器，负责客户端连接及消息转发到Game(游戏服),保持客户端到服务端的连接，没有任何逻辑，只做消息加密和解密，以及客户端和服务器消息的转发(相当于两者之间的桥梁)。</p>
</li>
<li>
<p><strong>GameServer</strong>: GameServer是游戏进程,提供游戏逻辑功能(采用单进程(或者单线程)模型,游戏服务器的瓶颈从来不在CPU,所以只做逻辑功能的话单线程足够了,在这里没必要用多线程或多进程)。</p>
</li>
<li>
<p><strong>DBManager</strong>: 实现数据库的读写，方便Game服务器异步读写数据库的数据(有些把数据库读写放在游戏服，没有单独的服务器，那恐怕游戏服单进程就不够用了)。</p>
</li>
<li>
<p><strong>GameManager</strong>: 负责管理所有的GameServer，GameServer之间消息转发，提供广播到所有Game的功能。</p>
</li>
</ol>
<p><img src="/img/game/game_server.png" alt="pic"></p>
<h2 id="4协议">4.协议</h2>
<ul>
<li>
<p><strong>HTTP</strong>: 客户端与服务器之间协议通信，可以用tcp或者http。主要看游戏模型，如果是那种弱联网单机玩法，用http足够了，像天天酷跑之类，只在需要的时候处理一条http请求响应。</p>
</li>
<li>
<p><strong>TCP</strong>: 不过tcp用的比较还是比较多的。现在的网络游戏大多数都是tcp，像MMORPG类游戏。我们现在的游戏就是同时用了http和tcp，客户端和游戏服采用http协议。只有多人战斗转向战斗服才采用tcp长链接。</p>
</li>
<li>
<p><strong>UDP</strong>: 当tcp无法支撑的时候，就需要根据udp定制协议了，在一些高效率的场景下比如moba和FPS游戏中,tcp的拥塞控制和超时重传并不适合，有些就用的udp,然后自己做丢包重发，拿网络公平性换游戏局部的效率。这里推荐一个业内常用的对UDP协议的封装：</p>
</li>
<li>
<p><strong>KCP</strong>: <a href="https://github.com/skywind3000/kcp">https://github.com/skywind3000/kcp</a> 任何做游戏后端开发以及想要对TCP/UDP协议有更深的了解的同学都可以学一下KCP。</p>
</li>
</ul>
<p>我个人并没有做过MOBA或者FPS类型的游戏，所以只是自己学习了 <strong>KCP</strong>， 依然受益颇深。</p>
<h2 id="5存盘">5.存盘</h2>
<p>有数据库就肯定有数据库读写操作，最主要的还是存盘(save),周期存盘还是即时存盘</p>
<p>即时存盘就是每一次操作数据都进行存到数据库，当然这样会导致对数据库的操作过于频繁，毕竟这是效率的瓶颈之一。</p>
<p>周期存盘也叫固定存盘，就是每隔固定时间存盘一次，比如10秒或者15秒，这样数据库的压力就会小很多，当然自己就要在服务端内存中做好数据操作，防止数据污染或者存盘不上导致回档。</p>
<h1 id="二开发一个游戏服务器需要掌握的开源技术">二.开发一个游戏服务器需要掌握的开源技术</h1>
<h2 id="网络库">网络库</h2>
<p>libevent,boost.asio等网络库，网上有很多开源网络库，与其自己造轮子，不如就用开源网络库作为自己服务器的通讯库。最出名的就属libevent和boost.asio了。</p>
<ul>
<li>
<p>Boost：Boost的ASIO是一个异步IO库，封装了对Socket的常用操作，简化了基于socket程序的开发。支持跨平台；</p>
</li>
<li>
<p>libevent：是一个C语言写的事件驱动的开源网络库；</p>
</li>
<li>
<p>skynet：云风写的 <strong>skynet(c + lua)</strong> 游戏服务器框架，简单好用；</p>
</li>
<li>
<p>Muduo：陈硕写的 <strong>Muduo(c++)</strong>，陈硕全程在秀他的c++技术；</p>
</li>
<li>
<p>KCP： 上面提到过了，主要是对UDP的封装，有兴趣的可以看下;</p>
</li>
</ul>
<h2 id="协议解析">协议解析</h2>
<p><strong>protobuf</strong>: 全称Google Protocol Buffers，是google开发的的一套用于数据存储，网络通信时用于协议编解码的工具库。它和XML或者JSON差不多，也就是把某种数据结构的信息，以某种格式（XML，JSON）保存起来，
protobuf与XML和JSON不同在于，protobuf是基于二进制的。主要用于数据存储、传输协议格式等场合。</p>
<p>protobuf他的优势是对于传输比较大的数据产生的数据很紧凑很小，可以明显减小传输量。</p>
<p>而且处理速度也比较快，又有各种编程语言的实现，例如C++,Java,PHP等等。
缺点是不能明文编辑(数据是二进制的)。</p>
<p>用protobuf rpc进行数据传输很方便，所以是一个不错的选择。google protobuf只负责消息的打包和解包,并不包含RPC的实现，所以需要自己实现。</p>
<h2 id="缓存">缓存</h2>
<ul>
<li>
<p>memcached:一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。可以用来做缓存，比如客户端本来每次操作都需要操作数据库，会严重影响效率，这时在中间加一层缓存系统，就提升了性能。基于http协议的通信用memcached是一个不错的选择，如果是tcp长链接，直接维护一个在线的内存对象就可以了。</p>
</li>
<li>
<p>Redis: 和memcached类似，主要的区别在于Redis支持存盘，可以当作数据储存，同时支持多种数据类型，比如ZSET经常用来做游戏排行榜。</p>
</li>
</ul>
<p>&lt;全文完&gt;</p>
<p>欢迎关注我的微信公众号：<strong>码农在新加坡</strong>，有更多好的技术分享。
<img src="/img/personal/qrcode_2.png" alt="pic"></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">码农在新加坡</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-11-21
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/cpp/static/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">c&#43;&#43;中static的用法详解</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/cpp/secondary_pointer/">
            <span class="next-text nav-default">二级指针的作用详解</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="left-pocket/left-pocket.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:majianfei1023@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/left-pocket" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/left-pocket" class="iconfont icon-zhihu" title="zhihu"></a>
  <a href="https://left-pocket.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2020 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>码农在新加坡</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>








</body>
</html>
