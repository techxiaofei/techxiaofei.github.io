<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>手游服务器开发技术详解 | Leftpocket的个人博客</title>
    <meta property="og:title" content="手游服务器开发技术详解 - Leftpocket的个人博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2021-11-21T14:00:51&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2021-11-21T14:00:51&#43;08:00'>
        
    <meta name="Keywords" content="[游戏开发]">
    <meta name="description" content="手游服务器开发技术详解">
        
    <meta name="author" content="leftpocket">
    <meta property="og:url" content="https://left-pocket.github.io/post/game/game_development/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    <script data-ad-client="ca-pub-8922621224955535" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    
    
    
    
    
        <link rel="stylesheet" href='/css/custom.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://left-pocket.github.io">
                        Leftpocket的个人博客
                    </a>
                
                <p class="description">码农在新加坡</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://left-pocket.github.io">首页</a>
                    
                    <a  href="https://left-pocket.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://left-pocket.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">手游服务器开发技术详解</h1>
        </header>
        <date class="post-meta meta-date">
            2021年11月21日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91'>游戏开发</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>原文地址：<a href="https://left-pocket.github.io/post/game/game_development/">https://left-pocket.github.io</a></p>
<p>回顾我的码农生涯，在做互联网电商后端开发之前做过大概6年的游戏后端开发，想总结一下手游后端开发技术的方方面面。</p>
<p>之前从事游戏服务器开发期间参与了不少项目，学到了很多游戏服务器开发技术，参与过几个不同架构的服务器开发，就此聊聊游戏服务器开发需要的技术，给刚进入游戏后端开发的同学一些指导。</p>
<p>这边文章我先说一下我理解的互联网和游戏后端开发的主要区别，然后着重讲一下游戏服务器开发需要的技术栈。</p>
<p>如果你想自己写一个服务器开发框架，那么希望这篇文章对你有一定的帮助。</p>
<h1 id="互联网和游戏后端开发的区别">互联网和游戏后端开发的区别</h1>
<h3 id="游戏特有的">游戏特有的：</h3>
<ul>
<li>
<p><strong>保持连接</strong>：游戏一般来说需要保持一个客户端到服务端的连接，可以对客户端的玩家的行为（移动，攻击，操作，互动，聊天）进行及时的反馈以及主动推送给相关的玩家。</p>
</li>
<li>
<p><strong>保持连接</strong>：服务端会保持一份玩家的实体，当玩家进行操作时，通信数据只需要发送修改的数据即可。</p>
</li>
<li>
<p><strong>保持连接</strong>：很多游戏服务器，尤其是 RPG，MOBA， FPS等游戏，对延迟容忍度非常低，网络拥堵情况下tcp协议由于重传机制，拥塞机制导致非常慢，就需要重新设计协议来处理。</p>
</li>
<li>
<p><strong>保持连接</strong>：游戏中的每一个操作都可能是一个数据，移动、攻击、交易、经验增长等等，所以游戏通常来说需要定时写数据，否则可能会有DB性能瓶颈。</p>
</li>
<li>
<p><strong>互动</strong>：很多游戏是多人游戏，需要玩家互动，这个时候需要保持任何玩家之间都能及时的互动或者沟通，对服务器架构上的设计就有一定的要求，互联网的很多业务分离的微服务架构，很难让所有的玩家能及时的沟通。</p>
</li>
</ul>
<h3 id="互联网特有的">互联网特有的：</h3>
<ul>
<li>
<p><strong>微服务</strong>：互联网应用一般来说只用关心自己的行为，而不太关注其他用户的行为，即使需要读到其他用户的数据，只需要刷新一下页面就好，也不需要服务端实时推送。</p>
</li>
<li>
<p><strong>读频繁</strong>：互联网一般是一个读频繁的场景，需要大量的读取数据，只有特定的行为才需要写入。</p>
</li>
<li>
<p><strong>无状态</strong>：互联网的应用一般是无状态的，也就是每次进行不同的操作，都需要服务端进行完整的数据读取操作。</p>
</li>
<li>
<p><strong>延迟容忍</strong>：可以容忍一定的延迟，100ms和10ms对用户的体验影响并不大。</p>
</li>
</ul>
<h1 id="一聊聊服务器开发有哪些东西要考虑">一.聊聊服务器开发有哪些东西要考虑</h1>
<h2 id="1开发语言的选择">1.开发语言的选择</h2>
<p>工欲善其事,必先利其器，选择一门适合的开发语法对后期开发有着事半功倍的作用。</p>
<p>业界主要的是c/c++ + Python/lua模式做游戏服务器。c/c++做网络通讯数据传输，python/lua做业务逻辑。这样既保持了网络传输的效率(c++)，又提升开发效率(Python/lua)，同时也支持热更新。</p>
<p>当然，也有其他服务器开发语言，erlang(没用过，页游公司用的多),c#(大棒子国喜欢用，神奇的民族),Java(第一次听说时我惊呆了),node.js(少量游戏用的,还有一个node.js写的引擎叫pemolo),php(做http协议通讯的游戏时php+mysql也不失为一种好选择),&hellip;</p>
<p>看过两个游戏服务器引擎</p>
<p>1.firefly(9秒社团开发的一款python游戏服务器框架) <a href="https://github.com/9miao/Firefly">https://github.com/9miao/Firefly</a></p>
<p>2.kbengine(作者说他按bigworld的架构来设计的,c++ + python的) <a href="https://github.com/kbengine/kbengine">https://github.com/kbengine/kbengine</a></p>
<h2 id="2数据库">2.数据库</h2>
<p>现在比较流行的两种数据库，关系型数据库mysql和非关系型数据库mongodb。这是我用的最多的两个数据库。也有直接用Redis做数据储存的，当然一般是用来做缓存多一点。</p>
<h2 id="3服务端架构">3.服务端架构</h2>
<p>讲一下我用过的其中一种架构模型，也是公司按着bigworld架构设计的：</p>
<ol>
<li>
<p><strong>GateServer</strong>: 首先要有一个GateServer(网关)服务器，负责客户端连接及消息转发到Game(游戏服),保持客户端到服务端的连接，没有任何逻辑，只做消息加密和解密，以及客户端和服务器消息的转发(相当于两者之间的桥梁)。</p>
</li>
<li>
<p><strong>GameServer</strong>: GameServer是游戏进程,提供游戏逻辑功能(采用单进程(或者单线程)模型,游戏服务器的瓶颈从来不在CPU,所以只做逻辑功能的话单线程足够了,在这里没必要用多线程或多进程)。</p>
</li>
<li>
<p><strong>DBManager</strong>: 实现数据库的读写，方便Game服务器异步读写数据库的数据(有些把数据库读写放在游戏服，没有单独的服务器，那恐怕游戏服单进程就不够用了)。</p>
</li>
<li>
<p><strong>GameManager</strong>: 负责管理所有的GameServer，GameServer之间消息转发，提供广播到所有Game的功能。</p>
</li>
</ol>
<p>
        <img class="mx-auto" alt="pic" src="/img/game/game_server.png" />   
    </p>
<h2 id="4协议">4.协议</h2>
<ul>
<li>
<p><strong>HTTP</strong>: 客户端与服务器之间协议通信，可以用tcp或者http。主要看游戏模型，如果是那种弱联网单机玩法，用http足够了，像天天酷跑之类，只在需要的时候处理一条http请求响应。</p>
</li>
<li>
<p><strong>TCP</strong>: 不过tcp用的比较还是比较多的。现在的网络游戏大多数都是tcp，像MMORPG类游戏。我们现在的游戏就是同时用了http和tcp，客户端和游戏服采用http协议。只有多人战斗转向战斗服才采用tcp长链接。</p>
</li>
<li>
<p><strong>UDP</strong>: 当tcp无法支撑的时候，就需要根据udp定制协议了，在一些高效率的场景下比如moba和FPS游戏中,tcp的拥塞控制和超时重传并不适合，有些就用的udp,然后自己做丢包重发，拿网络公平性换游戏局部的效率。这里推荐一个业内常用的对UDP协议的封装：</p>
</li>
<li>
<p><strong>KCP</strong>: <a href="https://github.com/skywind3000/kcp">https://github.com/skywind3000/kcp</a> 任何做游戏后端开发以及想要对TCP/UDP协议有更深的了解的同学都可以学一下KCP。</p>
</li>
</ul>
<p>我个人并没有做过MOBA或者FPS类型的游戏，所以只是自己学习了 <strong>KCP</strong>， 依然受益颇深。</p>
<h2 id="5存盘">5.存盘</h2>
<p>有数据库就肯定有数据库读写操作，最主要的还是存盘(save),周期存盘还是即时存盘</p>
<p>即时存盘就是每一次操作数据都进行存到数据库，当然这样会导致对数据库的操作过于频繁，毕竟这是效率的瓶颈之一。</p>
<p>周期存盘也叫固定存盘，就是每隔固定时间存盘一次，比如10秒或者15秒，这样数据库的压力就会小很多，当然自己就要在服务端内存中做好数据操作，防止数据污染或者存盘不上导致回档。</p>
<h1 id="二开发一个游戏服务器需要掌握的开源技术">二.开发一个游戏服务器需要掌握的开源技术</h1>
<h2 id="网络库">网络库</h2>
<p>libevent,boost.asio等网络库，网上有很多开源网络库，与其自己造轮子，不如就用开源网络库作为自己服务器的通讯库。最出名的就属libevent和boost.asio了。</p>
<ul>
<li>
<p>Boost：Boost的ASIO是一个异步IO库，封装了对Socket的常用操作，简化了基于socket程序的开发。支持跨平台；</p>
</li>
<li>
<p>libevent：是一个C语言写的事件驱动的开源网络库；</p>
</li>
<li>
<p>skynet：云风写的 <strong>skynet(c + lua)</strong> 游戏服务器框架，简单好用；</p>
</li>
<li>
<p>Muduo：陈硕写的 <strong>Muduo(c++)</strong>，陈硕全程在秀他的c++技术；</p>
</li>
<li>
<p>KCP： 上面提到过了，主要是对UDP的封装，有兴趣的可以看下;</p>
</li>
</ul>
<h2 id="协议解析">协议解析</h2>
<p><strong>protobuf</strong>: 全称Google Protocol Buffers，是google开发的的一套用于数据存储，网络通信时用于协议编解码的工具库。它和XML或者JSON差不多，也就是把某种数据结构的信息，以某种格式（XML，JSON）保存起来，
protobuf与XML和JSON不同在于，protobuf是基于二进制的。主要用于数据存储、传输协议格式等场合。</p>
<p>protobuf他的优势是对于传输比较大的数据产生的数据很紧凑很小，可以明显减小传输量。</p>
<p>而且处理速度也比较快，又有各种编程语言的实现，例如C++,Java,PHP等等。
缺点是不能明文编辑(数据是二进制的)。</p>
<p>用protobuf rpc进行数据传输很方便，所以是一个不错的选择。google protobuf只负责消息的打包和解包,并不包含RPC的实现，所以需要自己实现。</p>
<h2 id="缓存">缓存</h2>
<ul>
<li>
<p>memcached:一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。可以用来做缓存，比如客户端本来每次操作都需要操作数据库，会严重影响效率，这时在中间加一层缓存系统，就提升了性能。基于http协议的通信用memcached是一个不错的选择，如果是tcp长链接，直接维护一个在线的内存对象就可以了。</p>
</li>
<li>
<p>Redis: 和memcached类似，主要的区别在于Redis支持存盘，可以当作数据储存，同时支持多种数据类型，比如ZSET经常用来做游戏排行榜。</p>
</li>
</ul>
<p>&lt;全文完&gt;</p>
<p>欢迎关注我的微信公众号：<strong>码农在新加坡</strong>，有更多好的技术分享。

        <img class="mx-auto" alt="pic" src="/img/general/qrcode.jpg" />   
    </p>

        </div>

        


        


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91'>游戏开发</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "stormwy/blog-comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2021 <a href="https://left-pocket.github.io">Leftpocket的个人博客 By leftpocket</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://left-pocket.github.io/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">Leftpocket</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='//www.google.com/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://left-pocket.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://left-pocket.github.io/post/game/game_development/" title="手游服务器开发技术详解">手游服务器开发技术详解</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/cpp/secondary_pointer/" title="二级指针的作用详解">二级指针的作用详解</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/git/git_rebase/" title="git rebase使用详解">git rebase使用详解</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/golang/goroutine_implementation/" title="goroutine的实现原理">goroutine的实现原理</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/mysql/dead_lock/" title="MySQL死锁的产生">MySQL死锁的产生</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/golang/append/" title="Golang append是并发安全的吗">Golang append是并发安全的吗</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/golang/functional_options/" title="Golang函数式选项(Functional Options)编程模式">Golang函数式选项(Functional Options)编程模式</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/golang/decorator/" title="Golang装饰器(Decorator)设计模式">Golang装饰器(Decorator)设计模式</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/redis/redis_sds/" title="Redis SDS简单动态字符串">Redis SDS简单动态字符串</a>
    </li>
    
    <li>
        <a href="https://left-pocket.github.io/post/algorithm/bloom_filter/" title="布隆过滤器(Bloom Filter)详解">布隆过滤器(Bloom Filter)详解</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://left-pocket.github.io/categories/c&#43;&#43;/">c&#43;&#43; (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/db/">db (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/git/">git (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/golang/">Golang (5)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/hugo/">hugo (2)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/leetcode/">leetcode (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/mysql/">MySQL (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/others/">Others (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/redis/">Redis (2)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/server/">server (2)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/vscode/">vscode (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">游戏开发 (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/%E7%AE%97%E6%B3%95/">算法 (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计 (2)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/%E9%9D%A2%E8%AF%95/">面试 (1)</a></li>
    
    <li><a href="https://left-pocket.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题 (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://left-pocket.github.io/tags/c&#43;&#43;/">c&#43;&#43;</a>
    
    <a href="https://left-pocket.github.io/tags/db/">db</a>
    
    <a href="https://left-pocket.github.io/tags/git/">git</a>
    
    <a href="https://left-pocket.github.io/tags/golang/">Golang</a>
    
    <a href="https://left-pocket.github.io/tags/hugo/">hugo</a>
    
    <a href="https://left-pocket.github.io/tags/leetcode/">leetcode</a>
    
    <a href="https://left-pocket.github.io/tags/mysql/">MySQL</a>
    
    <a href="https://left-pocket.github.io/tags/redis/">Redis</a>
    
    <a href="https://left-pocket.github.io/tags/server/">Server</a>
    
    <a href="https://left-pocket.github.io/tags/snowflake/">snowflake</a>
    
    <a href="https://left-pocket.github.io/tags/ssr/">ssr</a>
    
    <a href="https://left-pocket.github.io/tags/tidb/">TiDB</a>
    
    <a href="https://left-pocket.github.io/tags/vscode/">vscode</a>
    
    <a href="https://left-pocket.github.io/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">游戏开发</a>
    
    <a href="https://left-pocket.github.io/tags/%E7%AE%97%E6%B3%95/">算法</a>
    
    <a href="https://left-pocket.github.io/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/">系统设计</a>
    
    <a href="https://left-pocket.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
    
    <a href="https://left-pocket.github.io/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://left-pocket.github.io/about/" title="关于我" style="color:#0000FF;">关于我-微信及公众号</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.zhihu.com/people/left-pocket" title="Leftpocket的知乎" style="color:#0000FF;">Leftpocket的知乎</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://left-pocket.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>