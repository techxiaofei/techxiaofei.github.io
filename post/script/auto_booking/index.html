<!DOCTYPE html>
<html
  lang="zh-cn"
  itemscope
  itemtype="http://schema.org/WebPage"
>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
          使用go语言开发自动化脚本 - 一键定场、抢购、预约、捡漏 - 科技小飞哥
        </title>
    

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="科技小飞哥" />
  <meta name="description" content="本篇博客的视频教程首发于 Youtube：科技小飞哥。 背景 不知道大家有没有这种经历，想要抢课，定场，发现抢不到，想要捡漏，又要随时刷，今天我就" />
<meta name="keywords" content="go" />





<meta name="sogou_site_verification" content="dtuHIGY7cK" />
<meta name="msvalidate.01" content="9CB8E7A6AD8ADF22F9ED93166445E5B9" />


<script data-ad-client="ca-pub-6791708134711137" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6791708134711137"
     crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-QZ3LW65VYR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QZ3LW65VYR');
</script>


<meta name="generator" content="Hugo 0.111.3" />


<link rel="canonical" href="https://www.techxiaofei.com/post/script/auto_booking/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.521bf0df4a696edd93489b3746a0e3f2fba7995a7cc3f459badc28ad64f82927.css" integrity="sha256-Uhvw30ppbt2TSJs3RqDj8vunmVp8w/RZutworWT4KSc=" media="screen" crossorigin="anonymous">







<meta property="og:title" content="使用go语言开发自动化脚本 - 一键定场、抢购、预约、捡漏" />
<meta property="og:description" content="本篇博客的视频教程首发于 Youtube：科技小飞哥。 背景 不知道大家有没有这种经历，想要抢课，定场，发现抢不到，想要捡漏，又要随时刷，今天我就" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.techxiaofei.com/post/script/auto_booking/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-12-14T13:00:51+08:00" />
<meta property="article:modified_time" content="2022-12-14T13:00:51+08:00" />
<meta itemprop="name" content="使用go语言开发自动化脚本 - 一键定场、抢购、预约、捡漏">
<meta itemprop="description" content="本篇博客的视频教程首发于 Youtube：科技小飞哥。 背景 不知道大家有没有这种经历，想要抢课，定场，发现抢不到，想要捡漏，又要随时刷，今天我就"><meta itemprop="datePublished" content="2022-12-14T13:00:51+08:00" />
<meta itemprop="dateModified" content="2022-12-14T13:00:51+08:00" />
<meta itemprop="wordCount" content="3056">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用go语言开发自动化脚本 - 一键定场、抢购、预约、捡漏"/>
<meta name="twitter:description" content="本篇博客的视频教程首发于 Youtube：科技小飞哥。 背景 不知道大家有没有这种经历，想要抢课，定场，发现抢不到，想要捡漏，又要随时刷，今天我就"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




  </head>
  <body>
    <div id="back-to-top"></div>

    <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">科技小飞哥</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/friend/">友链</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/about/">关于</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          <div class="mobile-menu-parent">
            <span class="mobile-submenu-open"></span>
            <a href="https://www.techxiaofei.com/">
              demo
            </a>
          </div>
          <ul class="mobile-submenu-list">
            
              <li>
                <a href="https://www.techxiaofei.com/post/demo/1-image/">Demo: Image</a>
              </li>
            
              <li>
                <a href="https://www.techxiaofei.com/post/demo/2-toc/">Demo: toc</a>
              </li>
            
              <li>
                <a href="https://www.techxiaofei.com/post/demo/3-syntax-highlighting/">Demo: Syntax Highlighting</a>
              </li>
            
              <li>
                <a href="https://www.techxiaofei.com/post/demo/4-footnote/">Demo: Footnote</a>
              </li>
            
              <li>
                <a href="https://www.techxiaofei.com/post/demo/5-math/">Demo: Math</a>
              </li>
            
              <li>
                <a href="https://www.techxiaofei.com/post/demo/6-shortcode-notice/">Demo: Shortcodes Notice</a>
              </li>
            
              <li>
                <a href="https://www.techxiaofei.com/post/demo/7-shortcodes-preview/">Demo: more Shortcodes</a>
              </li>
            
          </ul>
        
      </li>
    

    
  </ul>
</nav>


    

    

    


    <header id="header" class="header">
      <div class="logo-wrapper">
  <a href="/" class="logo">
    
      科技小飞哥
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/friend/">友链</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.techxiaofei.com/about/">关于</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          <a class="menu-item-link menu-parent" href="https://www.techxiaofei.com/">demo</a>
          <ul class="submenu">
            
              <li class="submenu-item">
                <a href="https://www.techxiaofei.com/post/demo/1-image/">Demo: Image</a>
              </li>
            
              <li class="submenu-item">
                <a href="https://www.techxiaofei.com/post/demo/2-toc/">Demo: toc</a>
              </li>
            
              <li class="submenu-item">
                <a href="https://www.techxiaofei.com/post/demo/3-syntax-highlighting/">Demo: Syntax Highlighting</a>
              </li>
            
              <li class="submenu-item">
                <a href="https://www.techxiaofei.com/post/demo/4-footnote/">Demo: Footnote</a>
              </li>
            
              <li class="submenu-item">
                <a href="https://www.techxiaofei.com/post/demo/5-math/">Demo: Math</a>
              </li>
            
              <li class="submenu-item">
                <a href="https://www.techxiaofei.com/post/demo/6-shortcode-notice/">Demo: Shortcodes Notice</a>
              </li>
            
              <li class="submenu-item">
                <a href="https://www.techxiaofei.com/post/demo/7-shortcodes-preview/">Demo: more Shortcodes</a>
              </li>
            
          </ul>

        

      </li>
    

    
    

    
  </ul>
</nav>

    </header>

    <div id="mobile-panel">
      <main id="main" class="main bg-llight wallpaper">
        <div class="content-wrapper">
    <div id="content" class="content">
      <article class="post">
        
        <header class="post-header">
          <h1 class="post-title">使用go语言开发自动化脚本 - 一键定场、抢购、预约、捡漏</h1>
          

          <div class="post-meta">
  <div class="post-meta-author">
    by
      <a href="/about">
        <span class="post-meta-author-name">
          科技小飞哥
        </span>
      </a>
    
  </div>

  <div class="post-meta-time">
    <time datetime="2022-12-14">
      2022-12-14
    </time>
  </div>

  


  <div class="post-meta__right">
    <span class="post-meta-more">
        约 3056 字 -
        预计阅读 7 分钟
      </span>

    <div class="post-meta-category">
        <a href="https://www.techxiaofei.com/categories/%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7/"> 脚本工具 </a>
          
      </div>


    
    


    
    
  </div>
</div>

        </header>

        
        <div class="post-content">
          <p>本篇博客的视频教程首发于 <a href="https://www.youtube.com/@techxiaofei"><strong>Youtube：科技小飞哥</strong></a>。
<img src="/img/personal/header.png" alt="header"></p>
<h1 id="背景">背景</h1>
<!-- 亲爱的小伙伴大家好 -->
<p>不知道大家有没有这种经历，想要抢课，定场，发现抢不到，想要捡漏，又要随时刷，今天我就来讲一下我是怎么使用Go语言开发自动化脚本来解决定场，抢购，预约的难题。</p>
<!--
本篇视频需要小伙伴们有一定的编码能力和基本的网络知识（http请求）即可，非常简单。
 -->
<h1 id="基础知识">基础知识</h1>
<h3 id="浏览器发送http请求">浏览器发送HTTP请求</h3>
<p>我们在浏览器中打开一个网站执行一系列操作，其实就是用户通过浏览器与网站服务器的HTTP交互的过程。</p>
<p>下图是一个最简单的流程：</p>
<p><img src="/img/app/http_flow.png" alt="http flow"></p>
<ol>
<li>用户在浏览器输入账号密码登录（也可能是扫描二维码或者第三方账号登录），然后浏览器会发送一个HTTP请求到网站服务器，网站服务器验证成功之后根据你的账号信息生成一个<code>Token</code>或者<code>Session</code>，然后把<code>Token</code>或者<code>SessionID</code>返回给浏览器并告诉浏览器登录成功，浏览器跳转登录后的页面。 <!-- Token和Session的区别 --></li>
<li>用户点击查询，比如查询是否有合适的Slot，浏览器发送查询HTTP请求给网站服务器，带上<code>Token</code>，<code>Token</code>是用来验证这个用户是谁，服务器验证成功之后返回可以预定的列表。比如一个可预订的时间列表。</li>
<li>用户选择列表里面一个可用的<code>Slot</code>，开始预订，浏览器发送预订HTTP请求给网站服务器，带上<code>Token</code>和<code>SlotId</code>，<code>SlotId</code>用来验证你要定的那个Slot是什么，比如是哪天什么时间段等等。如果服务器收到请求的时候这个<code>Slot</code>还是可用的，那么就记录下单并返回预订成功。</li>
<li>然后你就可以点击付款按钮，可以通过余额，银行卡或支付宝等第三方付款方式付款，付款成功会返回给浏览器告诉用户下单成功。</li>
</ol>
<h3 id="自动化流程">自动化流程</h3>
<p>理解了这个最简单的流程，那我们就可以开始想怎么样自动化流程。</p>
<p>最简单的情况就是：我们把查询和预订的过程自动化。当然登录的过程也是可以的，只不过很多第三方/二维码登录的，有时候还需要验证码，比较复杂，为了简单我就自己通过浏览器登录拿到Token之后自动查询和预订。</p>
<p><img src="/img/app/http_flow_auto.png" alt="http flow"></p>
<ol>
<li>登录成功后拿到Token。</li>
<li>脚本使用这个Token运行脚本工具，循环执行查询和预订的HTTP命令，如果预订成功，邮件通知给用户。</li>
<li>收到邮件之后打开浏览器付款。</li>
</ol>
<p>Token一般来说每次登录后有效期为1小时到1天左右（取决于网站服务器的设定），所以我们需要每段时间获取一次Token重新执行脚本。</p>
<h3 id="自动发送email">自动发送Email</h3>
<p>SMTP是发送邮件的协议，我们可以通过简单的代码来实现发送邮件的功能，在这里主要是通过<code>gomail.v2</code>的 Go语言库 来支持订购成功之后发送邮件通知。</p>
<p>每个邮件运营商 (qq, 163, gmail, outlook, &hellip;)都有自己的SMTP的域名和端口，
比如你使用qq邮箱发邮件，去QQ邮箱的 <a href="https://service.mail.qq.com/cgi-bin/help?id=28&amp;no=167&amp;subtype=1">帮助中心</a> 可以查到他们的SMTP服务器端口是465或者587，就用他们提供的<code>smtp.qq.com:587</code>，即可发送成功。</p>
<p>其他的SMTP协议的运营商可以查看我的另一个博客：</p>
<p><a href="https://www.techxiaofei.com/post/others/smtp/">各大邮箱smtp服务器及端口</a></p>
<!-- 基本所有主流的语言都是支持SMTP的，所以你使用其他语言也都可以发送。-->
<h1 id="实现">实现</h1>
<p>有了这些基础知识之后，我们就可以开始用代码实现脚本工具的自动化流程了。</p>
<h3 id="模拟">模拟</h3>
<p>需要实现自动化脚本，第一步就是需要模拟HTTP请求，相当于把用户在浏览器的一系列操作用代码来实现。</p>
<p>要代码实现我们就需要先知道发送的HTTP请求的URL,Header,Payload分别是什么。</p>
<h4 id="开发者模式">开发者模式</h4>
<p>在<strong>Chrome</strong>浏览器使用<code>F12</code>进入开发者模式，选择<strong>Network</strong>-&gt;找到HTTP请求的Name-&gt;可以看到右边有<strong>Header、Preview、Response</strong>等信息，这就是用户行为（点击事件）产生的网络交互，也就是浏览器向服务器请求数据并返回给浏览器的过程。</p>
<p>而我们要模拟的就是这个HTTP网络交互的行为。</p>
<p><img src="/img/app/copy_as_curl.png" alt="http flow"></p>
<p>找到你要模拟的HTTP请求的Name，右键-&gt;<code>Copy</code>-&gt;<code>Copy As cURL</code>。</p>
<h4 id="curl">cURL</h4>
<p><code>cURL</code>是一个Linux命令，开发人员使用它来与服务器进行数据交互，<strong>cURL</strong> 里面包括 url, body, header, 加密方式 等等，正确设置命令后执行即可得到服务器的正确响应。</p>
<p>拿到cURL我们可以写go语言代码来模拟HTTP请求，要自己填充Header，Body等信息。容易写错。庆幸的是，已经有人做了自动化的工具帮我们一键把cURL转成Go语言的代码，也就是说我们不用自己写具体的HTTP请求代码了。</p>
<p>网站地址：<a href="https://mholt.github.io/curl-to-go/">curl-to-go</a></p>
<p>我们把cURL复制到网站里面就可以实时得到具体的Go代码。</p>
<p><img src="/img/app/curl_to_go.png" alt="http flow"></p>
<p>当然这个工具只帮我们创建了Body的结构体，具体的值还是需要我们去填充，我们从curl里面找到
<code>--data-raw</code>来自己填进去即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a class="lnlinks" href="#hl-0-1"> 1</a>
</span><span class="lnt" id="hl-0-2"><a class="lnlinks" href="#hl-0-2"> 2</a>
</span><span class="lnt" id="hl-0-3"><a class="lnlinks" href="#hl-0-3"> 3</a>
</span><span class="lnt" id="hl-0-4"><a class="lnlinks" href="#hl-0-4"> 4</a>
</span><span class="lnt" id="hl-0-5"><a class="lnlinks" href="#hl-0-5"> 5</a>
</span><span class="lnt" id="hl-0-6"><a class="lnlinks" href="#hl-0-6"> 6</a>
</span><span class="lnt" id="hl-0-7"><a class="lnlinks" href="#hl-0-7"> 7</a>
</span><span class="lnt" id="hl-0-8"><a class="lnlinks" href="#hl-0-8"> 8</a>
</span><span class="lnt" id="hl-0-9"><a class="lnlinks" href="#hl-0-9"> 9</a>
</span><span class="lnt" id="hl-0-10"><a class="lnlinks" href="#hl-0-10">10</a>
</span><span class="lnt" id="hl-0-11"><a class="lnlinks" href="#hl-0-11">11</a>
</span><span class="lnt" id="hl-0-12"><a class="lnlinks" href="#hl-0-12">12</a>
</span><span class="lnt" id="hl-0-13"><a class="lnlinks" href="#hl-0-13">13</a>
</span><span class="lnt" id="hl-0-14"><a class="lnlinks" href="#hl-0-14">14</a>
</span><span class="lnt" id="hl-0-15"><a class="lnlinks" href="#hl-0-15">15</a>
</span><span class="lnt" id="hl-0-16"><a class="lnlinks" href="#hl-0-16">16</a>
</span><span class="lnt" id="hl-0-17"><a class="lnlinks" href="#hl-0-17">17</a>
</span><span class="lnt" id="hl-0-18"><a class="lnlinks" href="#hl-0-18">18</a>
</span><span class="lnt" id="hl-0-19"><a class="lnlinks" href="#hl-0-19">19</a>
</span><span class="lnt" id="hl-0-20"><a class="lnlinks" href="#hl-0-20">20</a>
</span><span class="lnt" id="hl-0-21"><a class="lnlinks" href="#hl-0-21">21</a>
</span><span class="lnt" id="hl-0-22"><a class="lnlinks" href="#hl-0-22">22</a>
</span><span class="lnt" id="hl-0-23"><a class="lnlinks" href="#hl-0-23">23</a>
</span><span class="lnt" id="hl-0-24"><a class="lnlinks" href="#hl-0-24">24</a>
</span><span class="lnt" id="hl-0-25"><a class="lnlinks" href="#hl-0-25">25</a>
</span><span class="lnt" id="hl-0-26"><a class="lnlinks" href="#hl-0-26">26</a>
</span><span class="lnt" id="hl-0-27"><a class="lnlinks" href="#hl-0-27">27</a>
</span><span class="lnt" id="hl-0-28"><a class="lnlinks" href="#hl-0-28">28</a>
</span><span class="lnt" id="hl-0-29"><a class="lnlinks" href="#hl-0-29">29</a>
</span><span class="lnt" id="hl-0-30"><a class="lnlinks" href="#hl-0-30">30</a>
</span><span class="lnt" id="hl-0-31"><a class="lnlinks" href="#hl-0-31">31</a>
</span><span class="lnt" id="hl-0-32"><a class="lnlinks" href="#hl-0-32">32</a>
</span><span class="lnt" id="hl-0-33"><a class="lnlinks" href="#hl-0-33">33</a>
</span><span class="lnt" id="hl-0-34"><a class="lnlinks" href="#hl-0-34">34</a>
</span><span class="lnt" id="hl-0-35"><a class="lnlinks" href="#hl-0-35">35</a>
</span><span class="lnt" id="hl-0-36"><a class="lnlinks" href="#hl-0-36">36</a>
</span><span class="lnt" id="hl-0-37"><a class="lnlinks" href="#hl-0-37">37</a>
</span><span class="lnt" id="hl-0-38"><a class="lnlinks" href="#hl-0-38">38</a>
</span><span class="lnt" id="hl-0-39"><a class="lnlinks" href="#hl-0-39">39</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Generated by curl-to-Go: https://mholt.github.io/curl-to-go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// curl &#39;https://www.zhihu.com/api/v4/answers/2807591609/voters&#39; \
</span></span></span><span class="line"><span class="cl"><span class="c1">//   -H &#39;authority: www.zhihu.com&#39; \
</span></span></span><span class="line"><span class="cl"><span class="c1">//   -H &#39;accept: */*&#39; \
</span></span></span><span class="line"><span class="cl"><span class="c1">//   -H &#39;accept-language: zh-CN,zh;q=0.9,en;q=0.8&#39; \
</span></span></span><span class="line"><span class="cl"><span class="c1">//   -H &#39;content-type: application/json&#39; \
</span></span></span><span class="line"><span class="cl"><span class="c1">//   --data-raw &#39;{&#34;type&#34;:&#34;up&#34;}&#39; \
</span></span></span><span class="line"><span class="cl"><span class="c1">//   --compressed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Payload</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Type</span> <span class="kt">string</span> <span class="s">`json:&#34;type&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">data</span> <span class="o">:=</span> <span class="nx">Payload</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">// fill struct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Type</span><span class="p">:</span> <span class="s">&#34;up&#34;</span><span class="p">,</span>  <span class="c1">// fill struct yourself based on the data-raw
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">payloadBytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// handle err
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">body</span> <span class="o">:=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">payloadBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">req</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="s">&#34;POST&#34;</span><span class="p">,</span> <span class="s">&#34;https://www.zhihu.com/api/v4/answers/2807591609/voters&#34;</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// handle err
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Authority&#34;</span><span class="p">,</span> <span class="s">&#34;www.zhihu.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Accept&#34;</span><span class="p">,</span> <span class="s">&#34;*/*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Accept-Language&#34;</span><span class="p">,</span> <span class="s">&#34;zh-CN,zh;q=0.9,en;q=0.8&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Other Headers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">DefaultClient</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// handle err
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="代码">代码</h3>
<p>整个流程清楚了，那么下一步就是打开你的编辑器，来实现代码了。我这里实现了一个网站的预订的代码，来给大家讲解一下，登录我并没有实现，而是使用<code>curl to go</code> 生成了Go语言代码并根据go struct改造具体条件。在Cookie没过期的情况下可以循环调用。</p>
<p>自动预订代码：<a href="https://https://github.com/techxiaofei/autobooking">github.com</a></p>
<p><img src="/img/app/auto_code.png" alt="auto_flow"></p>
<ol>
<li><code>query.go</code>，查询的HTTP请求，把刚才<code>curl-to-go</code>生成的Go代码Copy进来，填上Payload就可以请求成功了。</li>
<li><code>book.go</code>，把你刚才query的结果传进来，根据你的需求过滤满足条件的<code>Slot</code>，直接预订即可。</li>
<li><code>email.go</code>，发送邮件的接口，我使用了<code>gomail.v2</code>的库，非常好用。</li>
<li><code>config.go</code>，配置文件，通过json输入</li>
<li><code>parse.go</code>，解析respone的，</li>
<li><code>main.go</code>，主函数，读取json配置，定时执行查询和预订的接口，根据response的结果看是否成功，成功后发送邮件给你。</li>
<li><code>README.md</code>，告诉你怎么执行这个工具的。</li>
</ol>
<p>这是相对比较简单的流程。</p>
<p>所以我们要做的就是手动在浏览器登录（也可以代码模拟登录），然后把返回的token放到query的HTTP请求里面。更简单的做法是，直接把query的cURL拿来<code>curl-to-go</code>转成go语言，Cookie已经在Header里面了。</p>
<p>然后我们再写<code>booking</code>的的流程，正常来说在一段时间内的<code>Header</code>都是一样的，我们直接把query的<code>Header</code>存起来赋值给<code>booking</code>的HTTP请求即可。</p>
<p>然后再写定时，你可以开启一个定时器，可以每<strong>x</strong>秒执行一次，然后执行<strong>n</strong>次停下来，或者永久执行。只是这个token一段时间后会过期，需要重新从浏览器登录并拿到Token信息复制到代码里面执行。</p>
<p>下一步就是发邮件，我们使用SMTP请求发送邮件，需要配置两个邮件，A发给B，然后需要填写A邮箱的<code>SMTP+Port+email+password</code>。</p>
<p>我这边使用了gomail.v2的go语言库。</p>
<p>官网链接：<a href="https://pkg.go.dev/gopkg.in/gomail.v2">gomail.v2</a> 以供参考。</p>
<p>这样我们就写完代码了，
执行 <code>go run main.go</code> 就可以执行了。</p>
<p>然后你就可以玩玩手机等着预订成功之后给你发邮件了，你也可以只是查询，查询到之后给你发邮件你自己登录进去再预订。</p>
<h1 id="结语">结语</h1>
<p>代码放在了 <a href="https://https://github.com/techxiaofei/autobooking">Github</a> 上，有兴趣的小伙伴可以参考，只不过每个网站的HTTP调用的Header和payload的格式都不一样，还需要你自己修改一些代码。所以还需要有一定代码能力的人才可以改造成功。</p>
<!-- 微信公众号改为 原文，点击查看原文即可获取 -->
<p>但是整体的框架我已经搭好了，希望可以减少你大量的工作量。</p>
<p>请阅读你需要访问的网站的规定，是否禁止第三方脚本，避免自己的账号有被封禁的风险。请遵守法律法规。</p>
<p>&lt;全文完&gt;</p>
<h1 id="视频教程">视频教程</h1>
<p>本篇博客的视频教程首发于 <a href="https://www.youtube.com/@techxiaofei"><strong>Youtube：科技小飞哥</strong></a>。
<style>
    .meta-media {
      position: relative;
      margin-bottom: 30px;
      display: flex;
      width: 100%;
      height: 0;
      padding-bottom: 75%;
    }
    .video {
      position: absolute;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
    }
    </style>
    <div class="meta-media">
    <iframe src="https://www.youtube.com/embed/nMEZ7I6clZc" frameborder="no" scrolling="yes" allowfullscreen="allowfullscreen" high_quality="1" framespacing="1" class="video" >
    </iframe>
    </div></p>

        </div>

        
        



        
        
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/img/personal/wechat_pay.png">
        <span>微信打赏</span>
      </label>
    
  </div>
</div>


        <footer class="post-footer">
          


          
          <nav class="post-nav">
            
              <a class="prev" href="/post/system_design/password/">
                
                <i class="iconfont">
                  <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

                </i>
                <span class="prev-text nav-default">后端面试之系统设计 - 用户密码如何储存在DB里</span>
                <span class="prev-text nav-mobile">上一篇</span>
              </a>
            
              <a class="next" href="/post/hugo/hugo_adsense/">
                <span class="next-text nav-default">从零开始搭建个人博客网站系列 六、接入google adsense广告创收</span>
                <span class="prev-text nav-mobile">下一篇</span>
                
                <i class="iconfont">
                  <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

                </i>
              </a>
          </nav>
        </footer>
      </article>

      
      
        
      


      
      

  

  
  

  
  

  

  

    

  

  


    </div>

    
    <nav class="toc" id="toc">
    <div class="toc-title">文章目录</div>
    <div class="toc-content custom-scrollbar">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#浏览器发送http请求">浏览器发送HTTP请求</a></li>
        <li><a href="#自动化流程">自动化流程</a></li>
        <li><a href="#自动发送email">自动发送Email</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#模拟">模拟</a></li>
        <li><a href="#代码">代码</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </nav>


  </div>

      </main>

      <footer id="footer" class="footer">
        <div class="icon-links">
  
  
    <a href="https://space.bilibili.com/49756120" rel="me noopener" class="iconfont"
      title="bilibili"  target="_blank"
      >
      <svg
  class="icon" style="" viewBox="0 0 1024 1024" version="1.1" width="36"
  height="36" id="svg8">
  <path
      style=""
      d="M 744.60599,0.00486267 A 41.779915,41.779915 0 0 0 710.4184,18.673394 L 548.5048,255.32642 h -11.70046 a 41.779915,41.779915 0 0 0 -10.80295,-7.84928 L 235.66,97.084498 a 41.779915,41.779915 0 0 0 -20.07193,-4.960864 41.779915,41.779915 0 0 0 -18.3748,79.145436 L 359.4859,255.32642 H 128.16909 c -49.458302,0 -89.27932,39.82105 -89.27932,89.27932 v 508.65224 c 0,49.4583 39.821018,89.27934 89.27932,89.27934 h 19.48445 C 149.12802,984.5043 179.92773,1024 224.79179,1024 c 44.86407,0 75.66379,-39.4957 77.13826,-81.46268 H 719.98116 C 721.45559,984.5043 752.25533,1024 797.1194,1024 c 44.86406,0 75.6638,-39.4957 77.13824,-81.46268 h 21.57323 c 49.45831,0 89.27936,-39.82104 89.27936,-89.27934 V 344.60574 c 0,-49.45827 -39.82105,-89.27932 -89.27936,-89.27932 H 649.74567 L 779.38103,65.866924 A 41.779915,41.779915 0 0 0 744.60599,0.00486267 Z M 644.49108,418.70871 c 6.29985,0.21538 12.44451,2.01107 17.86888,5.22196 l 171.36218,98.10771 c 18.23417,10.21935 24.63334,33.34627 14.24614,51.48533 -10.38726,18.13909 -33.57344,24.32718 -51.61587,13.77296 L 624.9903,489.18895 c -15.21356,-8.41858 -22.66871,-26.1765 -18.03211,-42.93436 4.63664,-16.75784 20.15573,-28.14465 37.53289,-27.54588 z M 350.2006,432.31846 c 16.89952,0.0317 31.69582,11.33328 36.17844,27.62747 4.48262,16.2942 -2.44981,33.57765 -16.95507,42.24898 l -140.7157,86.91312 c -17.68528,11.18244 -41.09629,5.77692 -52.08912,-12.02686 -10.99282,-17.80373 -5.33855,-41.15658 12.58167,-51.95857 L 329.9002,438.2095 c 6.0643,-3.86439 13.10951,-5.90891 20.3004,-5.89104 z M 501.605,641.53985 c 3.75002,-0.15248 7.48645,0.53903 10.93349,2.0235 0.15842,0.0637 0.31618,0.12888 0.47325,0.19582 0.59328,0.27092 1.17574,0.56489 1.74609,0.88121 0.15868,0.0854 0.31643,0.17233 0.47325,0.2611 0.55694,0.32165 1.10131,0.66458 1.63185,1.02807 0.16455,0.1123 0.32777,0.2265 0.48956,0.34269 0.50382,0.36781 0.99371,0.75428 1.46868,1.15864 0.18724,0.15504 0.37218,0.31282 0.55484,0.47323 0.43271,0.38784 0.8518,0.79061 1.25653,1.20756 0.15449,0.16114 0.30679,0.32437 0.45693,0.48959 0.40798,0.44266 0.79989,0.89988 1.17494,1.37076 0.17799,0.22544 0.35205,0.45395 0.5222,0.68538 0.25932,0.34701 0.50964,0.70071 0.75064,1.06071 0.26712,0.39516 0.52286,0.79784 0.76699,1.20757 0.16907,0.29043 0.33231,0.58424 0.48957,0.88123 0.21836,0.41297 0.42513,0.83199 0.62009,1.25653 0.14836,0.32333 0.28983,0.64976 0.42429,0.97911 0.21319,0.51552 0.40915,1.03801 0.58747,1.5666 0.0677,0.19499 0.13296,0.39085 0.19582,0.58748 0.18652,0.60823 0.34984,1.22334 0.48957,1.84399 0.0397,0.16277 0.0779,0.32601 0.11423,0.48957 0.1436,0.69112 0.25788,1.38801 0.34269,2.08877 0.005,0.0381 0.0111,0.0761 0.0163,0.11424 0.0857,0.78056 0.13474,1.56471 0.14687,2.34988 0.005,0.0543 0.0111,0.10879 0.0163,0.1632 0,0 -0.008,1.12132 0,1.45234 0,0 -0.14697,17.84761 5.89102,34.12231 3.01902,8.13734 7.33278,15.10615 12.61433,19.61501 5.28157,4.50889 11.42894,7.62081 23.64572,7.62081 12.2168,0 18.36416,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.5953,-11.47767 12.6143,-19.61501 6.03799,-16.2747 5.89103,-34.12231 5.89103,-34.12231 -0.44885,-13.87045 10.45922,-25.46302 24.3311,-25.86506 13.87189,-0.40201 25.42828,10.53953 25.78348,24.41272 0,0 1.11929,25.7226 -9.00791,53.01927 -5.06359,13.64832 -13.1986,28.46036 -27.05631,40.29073 -13.85772,11.83039 -33.5454,19.63135 -56.20142,19.63135 -22.65603,0 -42.34371,-7.80096 -56.20141,-19.63135 -4.1801,-3.56856 -7.78733,-7.42433 -10.99878,-11.42303 -3.21235,4.00037 -6.81703,7.85309 -10.99876,11.42303 -13.85773,11.83039 -33.5454,19.63135 -56.20144,19.63135 -22.65601,0 -42.3437,-7.80096 -56.2014,-19.63135 -13.85775,-11.83037 -21.99272,-26.64241 -27.05632,-40.29073 -10.12725,-27.29667 -9.00789,-53.01928 -9.00789,-53.01927 0.20714,-13.83687 11.58744,-24.88848 25.42444,-24.69013 14.1263,0.19991 25.2971,12.0278 24.69011,26.14247 0,0 -0.14697,17.84761 5.89103,34.12231 3.01902,8.13734 7.31646,15.10615 12.598,19.61501 5.28155,4.50889 11.44526,7.62081 23.66203,7.62081 12.21681,0 18.36418,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.57899,-11.47767 12.598,-19.61501 5.76352,-15.53489 5.89112,-32.05691 5.89103,-33.56746 0.006,-0.37466 0.0111,-1.05336 0.0163,-1.20759 -0.0117,-0.74583 0.0105,-1.49177 0.0652,-2.23565 0.009,-0.15784 0.0204,-0.31561 0.0327,-0.47324 0.14204,-1.56859 0.43163,-3.12027 0.86487,-4.63449 0.0213,-0.0763 0.0433,-0.15244 0.0652,-0.22848 3.0335,-10.25748 12.24157,-17.46007 22.92769,-17.93417 z"
      id="rect824"/>
</svg>

    </a>


<a href="https://www.techxiaofei.com/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
  
</div>
<div class="friend-links">
  <span class="item-content"><b>友情链接：</b></span>
  <a href="https://www.amazonaws.cn/" title="亚马逊云科技">亚马逊云科技</a>
  <a href="https://dev.amazoncloud.cn/" title="亚马逊开发者社区">亚马逊开发者社区</a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2020 -
    2023
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        科技小飞哥
        
      </span></span>

  
  

  
</div>

      </footer>

      <div class="button__back-to-top">
        <a href="#back-to-top">
          <i class="iconfont">
            
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

          </i>
        </a>
      </div>
    </div>
    
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.574edebb5acbfa389031fb4cba02e78a96a20b13000df2ba62dd7a0c3b6c76a1.js" integrity="sha256-V07eu1rL&#43;jiQMftMugLnipaiCxMADfK6Yt16DDtsdqE=" crossorigin="anonymous"></script>




























  </body>
</html>
